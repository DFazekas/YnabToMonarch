<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YNAB to Monarch Money</title>
  <meta name="description" content="CSV Converter tool for migrating from YNAB to Monarch Money.">
  <link rel="stylesheet" href="https://example-styles.netlify.app/styles.css">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Loading spinner -->
  <div id="spinner" class="spinnerSection hidden">
    <div class="spinner"></div>
  </div>

  <!-- Header -->
  <header>
    <div class="donate-button">
      <a href="https://buymeacoffee.com/fazekasdevh" target="_blank" rel="noopener noreferrer">
        <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" />
      </a>
    </div>
    <h1>YNAB → Monarch Money</h1>
    <p id="subheader">Effortlessly migrate your YNAB register into Monarch</p>
  </header>


  <main>
    <!-- File uploader -->
    <section class="section">
      <div id="uploader" class="uploader" tabindex="0" aria-label="Upload CSV">
        <input type="file" id="fileInput" accept=".csv" hidden />
        <p>Drag &amp; drop or click to upload your YNAB register</p>
      </div>
      <br />
      <a href="#" id="howToFindRegisterFile" class="aligned-center">Where can I find my YNAB register file?</a>
    </section>

    <!-- Conversion form section -->
    <section id="conversion" class="section">
      <form id="conversionForm">
        <h2>Select Your Migration Method</h2>
        <div class="migration-cards">
          
          <div class="method-card">
            <div class="card-content">
              <div class="icon">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="#005B96">
                  <path d="M5 20h14v-2H5v2zm7-18v12l4-4h-3v-6h-2v6H8l4 4z" />
                </svg>
              </div>
              <h3>Download CSV ZIP</h3>
              <p>Save a zip folder containing all your YNAB account data. Upload manually into Monarch.</p>
              <button type="button" data-action="generate" class="btn btn-primary">Download ZIP</button>
            </div>
          </div>

          <div class="method-card">
            <div class="card-content">
              <div class="icon">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="#005B96">
                  <path d="M13 2L3 14h6v8l10-12h-6z" />
                </svg>
              </div>
              <h3>Auto-Import</h3>
              <p>Let our system automatically map and import your accounts into Monarch.</p>
              <button type="button" data-action="import" class="btn btn-primary">
                Start Auto-Import
              </button>
              <a href="#" id="howItWorksLink" class="card-hint">What is Auto-Import?</a>
            </div>
          </div>

        </div>
      </form>
    </section>

    <!-- Downloaded message -->
    <section id="importDetails" class="filled-box hidden">
      <p>
        Monarch Money currently only supports importing one account at a time.<br /><br />You can import the CSV files
        individually, or use our Auto-Import feature to process all your accounts automatically.
      </p>
      <div class="button-container">
        <button type="button" data-action="import" class="btn btn-primary">Auto-Import</button>
      </div>
    </section>

    <!-- Credentials Section -->
    <section id="credentials" class="section">
      <form id="credentialsForm">
        <h2>Monarch Credentials</h2>
        <p>Enter your Monarch credentials to control how to import your YNAB accounts.<br />
        </p>
        <br />

        <!-- Username -->
        <div class="input-group">
          <label for="monarchUsername">Username</label>
          <input type="text" id="monarchUsername" name="monarchUsername" placeholder="Enter your Monarch username"
            autocomplete="username" />
        </div>

        <!-- Password -->
        <div class="input-group">
          <label for="monarchPassword">Password</label>
          <input type="password" id="monarchPassword" name="monarchPassword" placeholder="Enter your password"
            autocomplete="current-password" />
        </div>

        <!-- OTP field is hidden by default -->
        <div class="input-group hidden" id="otpGroup">
          <label for="monarchOtp">OTP (One-Time Password)</label>
          <input type="text" id="monarchOtp" name="monarchOtp" placeholder="Enter OTP" />
        </div>

        <button type="button" data-action="login" class="btn btn-primary">Login</button>
      </form>
    </section>

    <section id="mappings"> <!--class="hidden">-->
      <h2>Map Accounts</h2>
      <div id="mappingsContainer"></div>
      <button type="button" data-action="applyMappings" class="btn btn-primary">Import into Monarch</button>
    </section>

    <section id="startOver"> <!--class="hidden">-->
      <button type="button" data-action="reset" class="btn btn-secondary">Start Over</button>
    </section>

    <section id="logs" class="hidden">
      <button type="button" data-action="toggleLogs" class="logs-toggle">Show Logs</button>
      <div id="logsContainer" class="hidden"></div>
    </section>

    <!-- Modal for "How does this work?" -->
    <div id="infoModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="howItWorksTitle">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Auto-Import</h2>
        <p>Our Auto‑Import feature makes it simple to bring your YNAB data into Monarch Money securely.</p>
        <h4>How it works</h4>
        <ol>
          <li>
            <strong>Sign In:</strong> We send your Monarch username &amp; password <em>once</em> to Monarch—just like
            you would on their website—and get back a short-lived access token.
          </li>
          <li>
            <strong>Fetch Your Accounts:</strong> Using that token, we pull your existing Monarch accounts.
          </li>
          <li>
            <strong>Define Your Mappings:</strong> For each YNAB account, choose whether to <em>create</em> a new
            Monarch account or <em>insert</em> into an existing one.
          </li>
          <li>
            <strong>Apply Changes:</strong> Once you review and confirm your mappings, we use the token to update your
            Monarch accounts accordingly.
          </li>
        </ol>
        <p class="note">
          <strong>Security Note:</strong> We never store your password—and your access token expires over time. Monarch
          doesn’t offer a public API, so this approach uses the same network calls their website does to bring your data
          in. It’s the only way for now, but your credentials remain safe with Monarch.
        </p>
      </div>
    </div>

    <!-- Modal for "How does this work?" -->
    <div id="registerFileModal" class="modal hidden" role="dialog" aria-modal="true"
      aria-labelledby="howToFindRegisterFileTitle">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Exporting Your YNAB Budget</h2>
        <h4>How to Export From YNAB:</h4>
        <ol>
          <li>
            <strong>Sign In:</strong> Log into your <a href="https://www.ynab.com">YNAB profile</a>.
          </li>
          <li>
            <strong>Open the Menu:</strong> From the dashboard, click your budget name in the top left corner.
          </li>
          <li>
            <strong>Export Budget:</strong> Then, select <em>Export Budget</em> from the dropdown menu. This action will
            download a zipped folder containing a <em>Budget.csv</em> and <em>Register.csv</em> file.
          </li>
          <li>
            <strong>Unzip:</strong> Lastly, unzip the downloaded folder. Upload the <em>Register.csv</em> file here.
          </li>
        </ol>
      </div>
    </div>

  </main>

  <!-- Footer section -->
  <footer>
    <div class="footer-row">
      <small class="left">© 2024 Fazekas Solutions</small>
      <small class="middle">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
          <path
            d="M12 2C9.243 2 7 4.243 7 7v3H5v12h14V10h-2V7c0-2.757-2.243-5-5-5zm0 2c1.654 0 3 1.346 3 3v3H9V7c0-1.654 1.346-3 3-3zm-5 8h10v10H7V12z" />
        </svg>
        Your financial data is processed securely and is not stored at any point.
      </small>
      <small class="right source-link">
        <a href="https://github.com/DFazekas/YnabToMonarch" target="_blank" rel="noopener noreferrer">
          Source on GitHub
        </a>
      </small>
    </div>
  </footer>



  <script type="module" src="/src/main.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
</body>

</html>