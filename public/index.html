<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YNAB to Monarch Money</title>
  <meta name="description" content="CSV Converter tool for migrating from YNAB to Monarch Money.">
  <link rel="stylesheet" href="https://example-styles.netlify.app/styles.css">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Loading spinner -->
  <div id="spinner" class="spinnerSection hidden">
    <div class="spinner"></div>
  </div>

  <!-- Header -->
  <header>
    <div class="donate-button">
      <a href="https://buymeacoffee.com/fazekasdevh" target="_blank" rel="noopener noreferrer">
        <img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" />
      </a>
    </div>
    <h1>YNAB ‚Üí Monarch Money</h1>
    <p id="subheader">Effortlessly migrate your YNAB register into Monarch</p>
  </header>


  <main>
    <!-- File uploader -->
    <section id="uploader-section" class="section">
      <div id="uploader" class="uploader" tabindex="0" aria-label="Upload CSV">
        <input type="file" id="fileInput" accept=".csv" hidden />
        <p>Drag &amp; drop or click to upload your YNAB register</p>
      </div>
      <br />
      <a href="#" id="howToFindRegisterFile" class="aligned-center">Where can I find my YNAB register file?</a>
    </section>

    <!-- Conversion form section -->
    <section id="conversion" class="section hidden">
      <form id="conversionForm">
        <h2>Select Your Migration Method</h2>
        <p>Found <strong><span id="accountCount">0</span> accounts</strong> in file.</p>
        <div class="migration-cards">

          <div class="method-card">
            <div class="card-content">
              <div class="icon">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="#005B96">
                  <path d="M5 20h14v-2H5v2zm7-18v12l4-4h-3v-6h-2v6H8l4 4z" />
                </svg>
              </div>
              <h3>Download CSV ZIP</h3>
              <p>Save a zip folder containing all your YNAB account data. Upload manually into Monarch.</p>
              <button type="button" data-action="download-zip" class="btn btn-primary">Download ZIP</button>
              <a href="#" id="preDownloadHowToImportLink" class="card-hint">How to Import into Monarch?</a>
            </div>
          </div>

          <div class="method-card">
            <div class="card-content">
              <div class="icon">
                <svg viewBox="0 0 24 24" width="24" height="24" fill="#005B96">
                  <path d="M13 2L3 14h6v8l10-12h-6z" />
                </svg>
              </div>
              <h3>Auto-Import</h3>
              <p>Let our system automatically map and import your accounts into Monarch.</p>
              <button type="button" data-action="start-auto-import" class="btn btn-primary">
                Start Auto-Import
              </button>
              <a href="#" id="preDownloadWhatIsAutoImporter" class="card-hint">What is Auto-Import?</a>
            </div>
          </div>

        </div>
      </form>
    </section>

    <!-- Downloaded message -->
    <section id="importDetails" class="section hidden">
      <form>
        <h2>Import Into Monarch</h2>
        <p>
          Monarch currently only supports manually importing one account at a time.
        </p>
        <br />

        <div class="migration-cards">

          <!-- Manual Import Card -->
          <div class="method-card">
            <div class="card-content">
              <h3>Manual CSV Import</h3>
              <p>Import one account at a time by uploading your CSVs.</p>

              <a href="#" id="postDownloadHowToImportLink" class="btn btn-secondary">
                View Import Guide
              </a>
            </div>
          </div>

          <!-- Auto Import Card -->
          <div class="method-card">
            <div class="card-content">
              <h3>Quick Auto-Import</h3>
              <p>Let us fetch & map all your YNAB accounts for you automatically.</p>
              <button type="button" data-action="import" class="btn btn-primary">
                Start Auto-Import
              </button>
              <a href="#" id="postDownloadWhatIsAutoImporter" class="card-hint">What is Auto-Import?</a>
            </div>
          </div>
      </form>
    </section>

    <!-- Credentials Section -->
    <section id="credentials" class="section hidden">

      <form id="loginForm">
        <h2>Monarch Credentials</h2>
        <p>Enter your Monarch credentials to control how to import your YNAB accounts.<br />
        </p>
        <br />

        <!-- Username -->
        <div class="input-group">
          <label for="monarchUsername">Username</label>
          <input type="text" id="monarchUsername" name="monarchUsername" placeholder="you@example.com"
            autocomplete="username" required />
        </div>

        <!-- Password -->
        <div class="input-group">
          <label for="monarchPassword">Password</label>
          <input type="password" id="monarchPassword" name="monarchPassword" placeholder="‚óè‚óè‚óè‚óè‚óè‚óè‚óè‚óè"
            autocomplete="current-password" required />
        </div>

        <button type="button" data-action="login" class="btn btn-primary">Login</button>
      </form>

      <form id="otpForm" class="hidden">
        <h2>Verify One-Time Password</h2>
        <p>Monarch sent a 6-digit code to your email.</p>
        <br />
        <div class="input-group">
          <label for="monarchOtp">One-Time Password (OTP)</label>
          <input type="text" id="monarchOtp" name="monarchOtp" inputMode="numeric" pattern="\d{6}"
            autocomplete="one-time-code" placeholder="123456" required />
        </div>

        <button id="verifyOtp" type="button" class="btn btn-primary">Verify Code</button>
        <a href="#" id="resendOtp" class="card-hint">Resend OTP</a>
      </form>
    </section>

    <form id="step1" class="section hidden">
      <div class="controls">
        <input type="text" id="ynabSearch" placeholder="üîç Search YNAB accounts..." />
        <button id="selectAllFiltered" type="button">Select All Filtered</button>
        <button id="deselectAll" type="button">Clear Selection</button>
      </div>
      <ul id="ynabList"></ul>
      <button id="toStep2" class="primary" disabled>Import ‚Üí</button>
    </form>

    <form id="step2" class="section hidden">
      <button id="backToStep1" type="button" class="secondary">‚Üê Choose YNAB accounts to import</button>

      <table id="mappingTable">
        <thead>
          <tr>
            <th>
              <input type="checkbox" id="selectAllRows" aria-label="Select all rows" />
            </th>
            <th>YNAB Account</th>
            <th>Transactions</th>
            <th>Monarch Account</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="summary" class="summary"></div>
      <button id="confirmImport" type="button" class="primary">Confirm & Import</button>

      <!-- floating bulk-action bar -->
      <div id="bulkActionBar" class="bulk-action-bar hidden">
        <button id="bulkClose" type="button" class="bar-btn" title="Unselect all">0 Accounts</button>
        <div class="bulk-separator"></div>
        <button id="bulkCreate" type="button" class="bar-btn" title="Create new accounts">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          <span class="label">Create new</span>
        </button>
        <button id="bulkReset" type="button" class="bar-btn" title="Reset mapping">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 0-6"></path>
          </svg>
          <span class="label">Reset</span>
        </button>
        <button id="bulkRename" type="button" class="bar-btn" title="Rename new accounts">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <path d="M12 20h9"></path>
            <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
          </svg>
          <span class="label">Rename</span>
        </button>
        <button id="bulkRemove" type="button" class="bar-btn" title="Remove selected">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          <span class="label">Remove</span>
        </button>
      </div>
    </form>

    <datalist id="monarchList"></datalist>

    <!-- Reset button -->
    <section id="startOver" class="hidden">
      <button type="button" data-action="reset" class="btn btn-secondary">Start Over</button>
    </section>

    <!-- Logs section -->
    <section id="logs" class="hidden">
      <button type="button" data-action="toggleLogs" class="logs-toggle">Show Logs</button>
      <div id="logsContainer" class="hidden"></div>
    </section>

    <section id="processing" class="processing-section">
      <div class="processing-card">
        <!-- Friendly title -->
        <h2 class="processing-title">üöÄ Migration Started!</h2>

        <!-- Explanatory copy -->
        <p class="processing-subtitle">
          We‚Äôve begun migrating your YNAB accounts into Monarch. This may take a few minutes.
        </p>
        <p class="processing-subtitle">
          When you‚Äôre ready, head over to your
          <a href="https://app.monarchmoney.com" target="_blank" rel="noopener noreferrer">
            Monarch dashboard
          </a>
          and refresh to see your new accounts.
        </p>

        <hr />

        <!-- CTA -->
        <p class="opensource-cta">
          ‚≠ê Love this tool?
          <a href="https://github.com/DFazekas/YnabToMonarch" target="_blank" rel="noopener noreferrer">
            Star us on GitHub
          </a>, file issues, or send a PR!
        </p>

        <!-- Corner ribbon for GitHub -->
        <a href="https://github.com/DFazekas/YnabToMonarch" class="github-corner" aria-label="View source on GitHub"
          target="_blank" rel="noopener noreferrer"></a>
      </div>
    </section>


    <!-- Modal for "How does Auto-Import work?" -->
    <div id="whatIsAutoImporterModal" class="modal hidden" role="dialog" aria-modal="true"
      aria-labelledby="whatIsAutoImporterTitle">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Auto-Import</h2>
        <p>Our Auto‚ÄëImport feature makes it simple to bring your YNAB data into Monarch Money securely.</p>
        <h4>How it works</h4>
        <ol>
          <li>
            <strong>Sign In:</strong> We send your Monarch username &amp; password <em>once</em> to Monarch‚Äîjust like
            you would on their website‚Äîand get back a short-lived access token.
          </li>
          <li>
            <strong>Fetch Your Accounts:</strong> Using that token, we pull your existing Monarch accounts.
          </li>
          <li>
            <strong>Define Your Mappings:</strong> For each YNAB account, choose whether to <em>create</em> a new
            Monarch account or <em>insert</em> into an existing one.
          </li>
          <li>
            <strong>Apply Changes:</strong> Once you review and confirm your mappings, we use the token to update your
            Monarch accounts accordingly.
          </li>
        </ol>
        <p class="note">
          <strong>Security Note:</strong> We never store your password‚Äîand your access token expires over time. Monarch
          doesn‚Äôt offer a public API, so this approach uses the same network calls their website does to bring your data
          in. It‚Äôs the only way for now, but your credentials remain safe with Monarch.
        </p>
      </div>
    </div>

    <!-- Modal for "Where to Find Register File?" -->
    <div id="whereToFindRegisterModal" class="modal hidden" role="dialog" aria-modal="true"
      aria-labelledby="whereToFindRegisterTitle">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Exporting Your YNAB Budget</h2>
        <h4>How to Export From YNAB:</h4>
        <ol>
          <li>
            <strong>Sign In:</strong> Log into your <a href="https://www.ynab.com" target="_blank"
              rel="noopener noreferrer">YNAB profile</a>.
          </li>
          <li>
            <strong>Open the Menu:</strong> From the dashboard, click your budget name in the top left corner.
          </li>
          <li>
            <strong>Export Budget:</strong> Then, select <em>Export Budget</em> from the dropdown menu. This action will
            download a zipped folder containing a <em>Budget.csv</em> and <em>Register.csv</em> file.
          </li>
          <li>
            <strong>Unzip:</strong> Lastly, unzip the downloaded folder. Upload the <em>Register.csv</em> file here.
          </li>
        </ol>
      </div>
    </div>

    <!-- Modal for "How to Manually Import into Monarch?" -->
    <div id="howToManuallyImportModal" class="modal hidden" role="dialog" aria-modal="true"
      aria-labelledby="howToManuallyImportTitle">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Manually Import Into Monarch</h2>
        <h4>How to Manually Import Transactions into Monarch:</h4>
        <ol>
          <li>
            <strong>Unzip Accounts:</strong> Find your downloaded ZIP folder containing your account data, then unzip
            its contents.
          </li>
          <li>
            <strong>Sign In:</strong> Log into your <a href="https://app.monarchmoney.com" target="_blank"
              rel="noopener noreferrer">Monarch profile</a>.
          </li>
          <li>
            <strong>(optional) Create an Account:</strong> Navigate to the <strong>Accounts</strong> page and click the
            <em>Add account</em> button. In the next window, select <em>Add manual account</em> and choose the
            appropriate <strong>type</strong>. Then give your account a <strong>name</strong> and set its starting
            <strong>Balance</strong> to zero.
          </li>
          <li>
            <strong>Open Account:</strong> Open the account you wish to import transactions into and click the
            <em>Edit</em> dropdown and select
            <em>Upload transactions</em>.
          </li>
          <li>
            <strong>Import Transactions:</strong> In the new window, click the <em>Upload a CSV file</em> button and
            choose the
            unzipped account file. Then <strong>enable</strong> the <em>Adjust account's balances based on these
              transactions</em> toggle, and click <em>Add to account</em>.
          </li>
          <li>
            <strong>Rinse & Repeat:</strong> Repeat the process for each account you want to import.
          </li>
        </ol>
      </div>
    </div>

    <!-- Bulk Rename Modal -->
    <div id="bulkRenameModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="bulkRenameTitle">
      <div class="modal-content">
        <span class="close" data-action="close">&times;</span>
        <h2 id="bulkRenameTitle">Bulk Rename Accounts</h2>
        <label for="bulkRenamePattern">
          Pattern:<br />
          <small>Use <code>{{origName}}</code> for the YNAB name, <code>{{index}}</code> for an incrementing
            number</small>
        </label>
        <input type="text" id="bulkRenamePattern" value="YNAB - {{origName}}" style="width:100%; margin-top:8px;" />
        <div class="modal-actions" style="margin-top:1rem; text-align:right;">
          <button id="bulkRenameCancel" class="btn btn-secondary">Cancel</button>
          <button id="bulkRenameApply" class="btn btn-primary">Apply</button>
        </div>
      </div>
    </div>

  </main>

  <!-- Footer section -->
  <footer>
    <div class="footer-row">
      <small class="left">¬© 2024 Fazekas Solutions</small>
      <small class="middle">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
          <path
            d="M12 2C9.243 2 7 4.243 7 7v3H5v12h14V10h-2V7c0-2.757-2.243-5-5-5zm0 2c1.654 0 3 1.346 3 3v3H9V7c0-1.654 1.346-3 3-3zm-5 8h10v10H7V12z" />
        </svg>
        Your financial data is processed securely and is not stored at any point.
      </small>
      <small class="right source-link">
        <a href="https://github.com/DFazekas/YnabToMonarch" target="_blank" rel="noopener noreferrer">
          Source on GitHub
        </a>
      </small>
    </div>
  </footer>


  <script type="module" src="/src/main.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
</body>

</html>